/*
 Copyright Meta Construct
 SPDX-License-Identifier: Apache-2.0
*/
function f(){this.s=document.querySelector(".error");this.g=document.querySelector("#canvas");this.h=document.querySelector("#external");this.o=this.g.getContext("2d");this.i=this.h.getContext("2d");this.a=320;this.f=80;this.j=null;this.b=10;this.c=[0,0];this.l=[0,0];this.u=!1;this.image=this.palette=null;g(this);h(this);k(this)}
function k(b){window.addEventListener("resize",function(){return g(b)});window.addEventListener("mouseup",function(){return b.u=!1});window.addEventListener("mousedown",function(c){b.u=!0;b.l=[c.clientX,c.clientY]});window.addEventListener("mousemove",function(c){if(b.u){var d=c.clientY-b.l[1];b.c[0]+=c.clientX-b.l[0];b.c[1]+=d;b.l=[c.clientX,c.clientY]}});window.addEventListener("wheel",function(c){c=b.b+-.1*c.deltaY;.2<c&&(b.b=c)});window.requestAnimationFrame(function(){return l(b)})}
function g(b){b.g.width=Math.max(document.documentElement.clientWidth||0,window.innerWidth||0);b.g.height=Math.max(document.documentElement.clientHeight||0,window.innerHeight||0);m(b)}
function h(b,c){c=void 0===c?0:c;b.m=new WebSocket("ws://"+document.location.host+"/");b.m.addEventListener("error",function(d){b.error(!0,"Error occurred!");console.error(d)});b.m.addEventListener("close",function(){b.error(!0,"WebSocket connection has closed.");3>=c&&h(b,c+1)});b.m.addEventListener("open",function(){b.error(!1);c=0});b.m.addEventListener("message",function(d){var e=JSON.parse(d.data);d=e.data;switch(e.op){case "imageInfo":e=d.image;b.palette=d.palette;b.image=e;break;case "addPixel":e=
d.xy;var n=d.steamId;b.image[e]=d.color;console.log(n,"placed a pixel at",e)}m(b)})}f.prototype.error=function(b,c){c=void 0===c?"":c;b?this.s.classList.remove("hidden"):this.s.classList.add("hidden");this.s.innerHTML=c};function l(b){if(b.j){var c=b.g,d=c.width;c=c.height;b.o.clearRect(0,0,d,c);b.o.imageSmoothingEnabled=!1;b.o.drawImage(b.j,b.c[0]+(d-b.a*b.b)/2,b.c[1]+(c-b.f*b.b)/2,b.a*b.b,b.f*b.b)}window.requestAnimationFrame(function(){return l(b)})}
function m(b){b.image&&b.palette?(b.h.width=b.a,b.h.height=b.f,b.i.fillStyle="#FFF",b.i.fillRect(0,0,b.a,b.f),b.image.forEach(function(c,d){var e=d%b.a;d=(d-e)/b.a;b.i.fillStyle="rgb("+(b.palette[c]||[255,255,255]).join(",")+")";b.i.fillRect(e,d,1,1)}),b.h.toBlob(function(c){c=URL.createObjectURL(c);b.j=new Image;b.j.src=c})):console.error("renderImage() was called when image or palette was not present")}window.a=new f;
